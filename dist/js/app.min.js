(()=>{"use strict";const e="https://www.thecocktaildb.com/api/json/v2/9973533/",t=async function(e){try{const n=fetch(e),r=await Promise.race([n,(t=5,new Promise((function(e,n){setTimeout((function(){n(new Error(`Request took too long! Timeout after ${t} second`))}),1e3*t)})))]),a=await r.json();if(!a.drinks)throw new Error("Cocktail is not found, sorry ğŸ¥º");return a}catch(e){throw e}var t},n={cocktail:{},search:{query:"",results:[],currentPage:1,resultsPerPage:5},favourites:[]},r=function(e=n.search.currentPage){n.search.currentPage=e;const t=5*(e-1),r=t+5;return n.search.results.slice(t,r)},a=function(){localStorage.setItem("favourites",JSON.stringify(n.favourites))};!function(){const e=localStorage.getItem("favourites");e&&(n.favourites=JSON.parse(e))}();class i{data;render(e,t=!0){if(!e||e.isArray&&0!==e.length)return this.renderError();this.data=e;const n=this.generateMarkup();if(!t)return n;this.clear(),this.paste(n)}update(e){this.data=e;const t=this.generateMarkup(),n=document.createRange().createContextualFragment(t),r=Array.from(n.querySelectorAll("*")),a=Array.from(this.parentElement.querySelectorAll("*"));r.forEach(((e,t)=>{const n=a[t];e.isEqualNode(n)||""===e.firstChild?.nodeValue.trim()||(n.textContent=e.textContent),e.isEqualNode(n)||Array.from(e.attributes).forEach((e=>n.setAttribute(e.name,e.value)))}))}clear(){this.parentElement.innerHTML=""}paste(e){this.parentElement.insertAdjacentHTML("afterbegin",e)}renderSpinner(){this.clear(),this.paste('<div class="spinner">\n\t <svg>\n\t\t<use href="../../img/icons.svg#icon-spinner"></use>\n\t </svg>\n  </div>')}renderError(e=this.errorMessage){const t=`<div class="error">\n\t <div>\n\t\t<svg>\n\t\t  <use href="../../img/icons.svg#icon-bulb"></use>\n\t\t</svg>\n\t </div>\n\t <p>${e}</p>\n  </div>`;this.clear(),this.paste(t)}renderMessage(e=this.message){const t=`<div class="message">\n\t<div>\n\t  <svg>\n\t\t <use href="../../img/icons.svg#icon-bulb"></use>\n\t  </svg>\n\t</div>\n\t<p>${e}</p>\n </div>`;this.clear(),this.paste(t)}}const s=new class extends i{parentElement=document.querySelector(".recipe");errorMessage="Sorry, wrong requestğŸ¥º";message="Start by searching for a cocktailğŸ¹ğŸ¸ğŸ‹";addHandlerRender(e){window.addEventListener("hashchange",e)}addHandlerAddToFavourites(e){this.parentElement.addEventListener("click",(t=>{t.target.closest(".recipe__favourite")&&e()}))}generateIngredientMarkup(e){return e.reduce(((e,t)=>e+`<li class="recipe__ingredient ingredient">\n\t\t  <figure class="ingredient__image">\n\t\t\t <img src="${t.ingredientThumbLink}" alt="${t.ingredientName}" />\n\t\t  </figure>\n\t\t  <span class="ingredient__name">${t.ingredientName}</span>\n\t\t  <span class="ingredient__measurement">${t.ingredientMeasure}</span>\n\t\t</li>`),"")}generateMarkup(){const e=this.generateIngredientMarkup(this.data.ingredientsArray);return`<figure class="recipe__figure">\n\t <img\n\t src="${this.data.imageURL}"\n\t\talt="${this.data.name}"\n\t\tclass="recipe__image"\n\t\tcrossorigin\n\t />\n\t <div class="recipe__header">\n\t\t<h1 class="recipe__title title title-1">\n\t\t  <span>${this.data.name}</span>\n\t\t</h1>\n\t\t<button class="recipe__favourite">\n\t\t  <svg>\n\t\t\t <use href="./img/icons.svg#icon-star-${this.data.bookmarked?"full":"empty"}"></use>\n\t\t  </svg>\n\t\t</button>\n\t </div>\n\t <div class="recipe__details details">\n\t\t<div class="details__item">\n\t\t  <p class="details__description">${"Alcoholic"===this.data.alcoholic?"ğŸ˜ˆ":"Non alcoholic"===this.data.alcoholic?"ğŸ‘¼ğŸ¼":"ğŸ¤”"}${this.data.alcoholic}</p>\n\t\t</div>\n\t\t<div class="details__item">\n\t\t  <p class="details__description">ğŸ¹${this.data.glass}</p>\n\t\t</div>\n\t </div>\n  </figure>\n  <div class="recipe__body">\n\t <ul class="recipe__part recipe__ingredients">\n\t ${e}\n\t </ul>\n\t <div class="recipe__part recipe__instructions">\n\t ${this.data.instructions}\n\t </div>\n  </div>`}},c=new class{parentElement=document.querySelector(".search");clear(){this.parentElement.querySelector(".search__input").value=""}getQuery(){return this.parentElement.querySelector(".search__input").value}addHandlerSearch(e){this.parentElement.addEventListener("submit",(t=>{t.preventDefault(),e(),this.clear()}))}},o=new class extends i{parentElement="";generateMarkup(){const e=window.location.hash.slice(1),t=this.data;return`<li class="sidebar__item preview">\n\t<a class="preview__link ${t.id===e?"preview__link--active":""}\n\t" href="#${t.id}">\n\t  <figure class="preview__image">\n\t\t <img src=${t.imageURL} alt="${t.name}" crossorigin />\n\t  </figure>\n\t  <div class="preview__data">\n\t\t <h4 class="preview__title">${t.name}</h4>\n\t\t <p class="preview__additional">${t.category}</p>\n\t  </div>\n\t</a>\n </li>`}},d=new class extends i{parentElement=document.querySelector(".sidebar__list");errorMessage="Sorry, we couldn't find this drink in our collectionğŸ¥º";message="Start by searching for a cocktail or an ingredientğŸ¹ğŸ¸ğŸ‹";generateMarkup(){return this.data.map((e=>o.render(e,!1))).join("")}},l=new class extends i{parentElement=document.querySelector(".pagination__body");constructor(){super(),this.currentPage=1,this.numbersShown=5}generateNumbers(){const e=this.data,t=this.calculateNumPages(e),n=Math.max(1,this.currentPage-Math.floor(this.numbersShown/2)),r=Math.min(t,n+this.numbersShown-1);let a="";for(let t=n;t<=r;t++)a+=this.generatePaginationNumber(t,e.currentPage);return a}generateMarkup(){const e=this.data,t=this.calculateNumPages(e);return 1===t?"":`\n      ${this.generatePrevButton(e.currentPage)}\n      <div class="pagination__numbers" id="pagination-numbers">\n        ${this.generateNumbers()}\n      </div>\n      ${this.generateNextButton(e.currentPage,t)}\n    `}calculateNumPages(e){const t=e.results.length,n=e.resultsPerPage;return Math.ceil(t/n)}generatePaginationNumber(e,t){return`\n      <a href="#" data-page="${e}" class="pagination__button pagination__number ${t===e?"active":""}">\n        ${e}\n      </a>\n    `}generatePrevButton(e){return`\n      <a href="#" data-page="${e-1}" class="pagination__button pagination__arrow pagination__arrow_prev ${1===e?"disabled":""}" id="prev-button">\n        <svg><use href="./img/icons.svg#icon-circle-left"></use></svg>\n      </a>\n    `}generateNextButton(e,t){return`\n      <a href="#" data-page="${e+1}" class="pagination__button pagination__arrow pagination__arrow_next ${e===t?"disabled":""}" id="next-button">\n        <svg><use href="./img/icons.svg#icon-circle-right"></use></svg>\n      </a>\n    `}addHandlerClick(e){this.parentElement.addEventListener("click",(t=>{const n=t.target.closest(".pagination__button");if(!n)return;const r=+n.dataset.page;if(n.classList.contains("pagination__number"))this.currentPage=r;else if("prev-button"===n.id)this.currentPage>1&&this.currentPage--;else if("next-button"===n.id){const e=this.calculateNumPages(this.data);this.currentPage<e&&this.currentPage++}e(this.currentPage)}))}},u=new class extends i{parentElement=document.querySelector(".favourites__list");errorMessage="Add your favouritesğŸ¹ğŸ¸";message="";generateMarkup(){return Array.from(this.data).map((e=>o.render(e,!1))).join("")}addHandlerRender(e){window.addEventListener("load",e())}},g=(document.querySelector(".recipe"),async function(){try{s.renderSpinner(),d.update(r());const a=window.location.hash.slice(1);await async function(r){try{const a=(await t(`${e}lookup.php?i=${r}`)).drinks[0];function i(e){const t=[];for(let n=1;n<=15;n++){const r=e[`strIngredient${n}`],a=e[`strMeasure${n}`];r&&a&&t.push({ingredientName:r,ingredientMeasure:a,ingredientThumbLink:`https://www.thecocktaildb.com/images/ingredients/${r.toLowerCase()}-Small.png`})}return t}const s=i(a);n.cocktail={id:a.idDrink,name:a.strDrink,alcoholic:a.strAlcoholic,glass:a.strGlass,instructions:a.strInstructions,imageURL:a.strDrinkThumb,ingredientsArray:s,category:a.strCategory},n.favourites.some((e=>e.id===r))?(n.cocktail.bookmarked=!0,console.log(n.cocktail.bookmarked)):n.cocktail.bookmarked=!1}catch(c){throw c}}(a);const{cocktail:i}=n;s.render(i),u.update(n.favourites)}catch(e){s.renderError()}});u.addHandlerRender((function(){u.render(n.favourites)})),s.addHandlerRender(g),s.renderMessage(),s.addHandlerAddToFavourites((function(){var e;n.cocktail.bookmarked?function(e){const t=n.favourites.findIndex((t=>t.id===e));n.favourites.splice(t,1),e===n.cocktail.id&&(n.cocktail.bookmarked=!1),a()}(n.cocktail.id):(e=n.cocktail,n.favourites.push(e),e.id===n.cocktail.id&&(n.cocktail.bookmarked=!0),a()),s.update(n.cocktail),u.render(n.favourites)})),c.addHandlerSearch((async function(){try{d.renderSpinner();const a=c.getQuery();if(!a)return;await async function(r){try{n.search.query=r;const a=(await t(`${e}search.php?s=${r}`)).drinks;n.search.results=a.map((e=>({id:e.idDrink,name:e.strDrink,category:e.strCategory,imageURL:e.strDrinkThumb,favourite:!1}))),n.search.currentPage=1}catch(e){throw e}}(a),d.render(r()),l.render(n.search)}catch(e){d.renderError()}})),l.addHandlerClick((function(e){d.render(r(e)),l.render(n.search)}))})();